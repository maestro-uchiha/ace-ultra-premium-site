<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{{TITLE}} | {{BRAND}}</title>
  <meta name="description" content="{{DESCRIPTION}}">
  <link rel="canonical" href="{{PREFIX}}index.html">

  <!-- Open Graph -->
  <meta property="og:title" content="{{TITLE}} | {{BRAND}}">
  <meta property="og:description" content="{{DESCRIPTION}}">
  <meta property="og:image" content="{{PREFIX}}assets/img/og.jpg">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">

  <link rel="icon" href="{{PREFIX}}assets/favicon.ico">

  <!-- Early theme boot (prevents flash); bake.ps1 will skip its own boot if this id exists -->
  <script id="asd-theme-boot">
    (function () {
      try {
        var key = 'asd-theme';
        var saved = localStorage.getItem(key);
        var theme = saved ? saved : (
          window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        );
        document.documentElement.setAttribute('data-theme', theme);
      } catch (e) {}
    })();
  </script>

  <link rel="stylesheet" href="{{PREFIX}}assets/css/style.css">

  <!-- Feeds (RSS is here; bake.ps1 will add Atom if missing without duplicating) -->
  <link rel="alternate" type="application/rss+xml" title="{{BRAND}} Blog" href="{{PREFIX}}feed.xml">
</head>
<body>
  <header>
    <h1><a href="{{PREFIX}}index.html">{{BRAND}}</a></h1>

    <!-- Mobile toggle (CSS bars, ASCII-safe) -->
    <button id="navToggle" class="nav-toggle"
            aria-expanded="false" aria-controls="site-nav" aria-label="Open menu">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>

    <!-- Collapsible nav -->
    <nav id="site-nav">
      <ul>
        <li><a href="{{PREFIX}}index.html">Home</a></li>
        <li><a href="{{PREFIX}}blog/">Blog</a></li>
        <li><a href="{{PREFIX}}about.html">About</a></li>
        <li><a href="{{PREFIX}}contact.html">Contact</a></li>
        <li><a href="{{PREFIX}}legal/privacy.html">Privacy</a></li>
        <li><a href="{{PREFIX}}legal/terms.html">Terms</a></li>
        <li><a href="{{PREFIX}}sitemap.html">Sitemap</a></li>
      </ul>
    </nav>
  </header>

  <main>
    {{CONTENT}}
  </main>

  <footer>
    <p>
      <a href="{{PREFIX}}index.html">Home</a> |
      <a href="{{PREFIX}}blog/">Blog</a> |
      <a href="{{PREFIX}}about.html">About</a> |
      <a href="{{PREFIX}}contact.html">Contact</a> |
      <a href="{{PREFIX}}legal/privacy.html">Privacy</a> |
      <a href="{{PREFIX}}legal/terms.html">Terms</a> |
      <a href="{{PREFIX}}sitemap.html">Sitemap</a>
    </p>
    <p>&copy; {{YEAR}} {{BRAND}}. All rights reserved.</p>
  </footer>

  <!-- Theme toggle button (uses your .theme-toggle styles) -->
  <!-- ASD:THEME_TOGGLE -->
  <button class="theme-toggle" id="themeToggle" type="button" title="Toggle theme" aria-label="Toggle theme">
    🌙 / ☀
  </button>

  <script>
    /* Mobile menu */
    (function () {
      var btn = document.getElementById('navToggle');
      var nav = document.getElementById('site-nav');
      if (!btn || !nav) return;

      function set(open) {
        btn.setAttribute('aria-expanded', open);
        nav.classList.toggle('open', open);
        btn.classList.toggle('is-active', open);
      }
      btn.addEventListener('click', function () {
        set(btn.getAttribute('aria-expanded') !== 'true');
      });
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') set(false);
      });
      nav.addEventListener('click', function (e) {
        if (e.target && e.target.tagName === 'A') set(false);
      });
    })();

    /* Theme toggle (works with tokens in style.css) */
    (function () {
      var KEY = 'asd-theme';
      function apply(t) {
        document.documentElement.setAttribute('data-theme', t);
        try { localStorage.setItem(KEY, t); } catch (e) {}
      }
      function initial() {
        try {
          var saved = localStorage.getItem(KEY);
          if (saved === 'dark' || saved === 'light') return saved;
        } catch (e) {}
        return (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';
      }
      function ready(fn) {
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
        else fn();
      }
      ready(function () {
        var btn = document.getElementById('themeToggle');
        if (!btn) return;
        // Ensure current state is applied (boot already set attribute; this syncs storage if needed)
        apply(document.documentElement.getAttribute('data-theme') || initial());
        btn.addEventListener('click', function () {
          var cur = document.documentElement.getAttribute('data-theme') || 'light';
          apply(cur === 'dark' ? 'light' : 'dark');
        });
      });
    })();
  </script>
</body>
</html>
